<!DOCTYPE html>
<html>
<head>
  <script src="/node_modules/vega/build/vega.js"></script>
  <script src="/build/vega-lite.js"></script>
</head>
<body>

  <div id="vis"></div>

  <script type="text/javascript">
    function embed(vlSpec) {
      var vgSpec = vl.compile(vlSpec).spec;
      view = new vega.View(vega.parse(vgSpec))
        .renderer('svg')    // set renderer (canvas or svg)
        .initialize('#vis') // initialize view within parent DOM container
        .run();
    }

    var winSrc = ['mousemove', 'mouseup'];
    function mouseEvt(type, target, opts) {
      var evt;
      target = winSrc.indexOf(type) < 0 ? target : window;
      opts.bubbles = true;

      target.dispatchEvent(new MouseEvent('mousemove',
        vega.extend({}, opts, {clientX: opts.clientX - 10, clientY: opts.clientY - 10})));

      target.dispatchEvent(new MouseEvent('mousemove', opts));

      if(type === 'wheel') {
        evt = document.createEvent('SVGZoomEvent');
        evt.initUIEvent('wheel', true, true, window, opts.delta);
      } else {
        evt = new MouseEvent(type, opts);
      }

      target.dispatchEvent(evt);

      target.dispatchEvent(new MouseEvent('mousemove',
        vega.extend({}, opts, {clientX: opts.clientX + 10, clientY: opts.clientY + 10})));
    }

    function mark(id, parent) {
      return document.querySelector((parent ? `g.${parent} ` : '') +
        `g.role-circle path:nth-child(${id})`);
    }

    function coords(el) {
      var rect = el.getBoundingClientRect();
      return [Math.ceil(rect.left), Math.ceil(rect.top)];
    }

    function click(el, evt) {
      mouseEvt('mousedown', el, evt);
      mouseEvt('mouseup', window, evt);
      mouseEvt('click', el, evt);
    }

    function brush(id0, id1, parent) {
      var el0 = mark(id0, parent);
      var el1 = mark(id1, parent);
      var [mdX, mdY] = coords(el0);
      var [muX, muY] = coords(el1);
      mouseEvt('mousedown', el0, {clientX: mdX, clientY: mdY});
      mouseEvt('mousemove', window, {clientX: (muX - mdX) / 2, clientY: (muY - muY) / 2});
      mouseEvt('mouseup', window, {clientX: muX, clientY: muY});
      return view.data('sel_store');
    }

    function pt(id, parent) {
      var el = mark(id, parent);
      var [clientX, clientY] = coords(el);
      click(el, {clientX, clientY});
      return view.data('sel_store');
    }

    function clear(id, parent) {
      var bg = document.querySelector((parent ? `g.${parent} ` : '') + 'path.background');
      var el = mark(id, parent);
      var [clientX, clientY] = coords(el);
      clientX += 10;
      clientY -= 10;
      click(bg, {clientX, clientY});
      return view.data('sel_store');
    }
  </script>
</body>
</html>
